const mongoose = require('mongoose');
const User = require('../models/userModel');
const Category = require('../models/categoryModel');
const Product = require('../models/productModel');
require('dotenv').config();

const users = [
    {
        username: "admin",
        email: "admin@example.com",
        password: "$2a$10$XQgBVJRrm2K5lcWGrgw/W.OYO.vLPCGybLJmYMRhj1VJyWgjvjsKe", // "password123"
        role: "admin",
        phone: "0123456789",
        address: {
            street: "123 Admin St",
            city: "Admin City",
            state: "AS",
            zipCode: "12345"
        }
    },
    {
        username: "user1",
        email: "user1@example.com",
        password: "$2a$10$XQgBVJRrm2K5lcWGrgw/W.OYO.vLPCGybLJmYMRhj1VJyWgjvjsKe", // "password123"
        role: "user",
        phone: "0987654321",
        address: {
            street: "456 User St",
            city: "User City",
            state: "US",
            zipCode: "67890"
        }
    }
];

const categories = [
    {
        name: "Điện thoại",
        description: "Các loại điện thoại di động",
        image: "https://example.com/phone.jpg"
    },
    {
        name: "Laptop",
        description: "Các loại máy tính xách tay",
        image: "https://example.com/laptop.jpg"
    },
    {
        name: "Tablet",
        description: "Các loại máy tính bảng",
        image: "https://example.com/tablet.jpg"
    }
];

const products = [
    {
        name: "iPhone 13",
        description: "iPhone 13 mới nhất từ Apple",
        price: 999.99,
        category: null, // Sẽ được set sau khi tạo category
        image: "https://example.com/iphone13.jpg",
        stock: 50,
        rating: 4.5,
        numReviews: 10
    },
    {
        name: "MacBook Pro",
        description: "MacBook Pro với chip M1",
        price: 1299.99,
        category: null, // Sẽ được set sau khi tạo category
        image: "https://example.com/macbook.jpg",
        stock: 30,
        rating: 4.8,
        numReviews: 15
    },
    {
        name: "iPad Pro",
        description: "iPad Pro 12.9 inch",
        price: 799.99,
        category: null, // Sẽ được set sau khi tạo category
        image: "https://example.com/ipad.jpg",
        stock: 40,
        rating: 4.6,
        numReviews: 8
    }
];

const seedDatabase = async () => {
    try {
        // Connect to database
        await mongoose.connect(process.env.CONNECTION_STRING);
        console.log('Connected to MongoDB');

        // Clear existing data
        await User.deleteMany();
        await Category.deleteMany();
        await Product.deleteMany();

        // Seed users
        const createdUsers = await User.insertMany(users);
        console.log('Users seeded');

        // Seed categories
        const createdCategories = await Category.insertMany(categories);
        console.log('Categories seeded');

        // Add category references to products
        const productsWithCategories = products.map((product, index) => {
            let categoryId;
            if (index === 0) categoryId = createdCategories[0]._id; // Phone
            else if (index === 1) categoryId = createdCategories[1]._id; // Laptop
            else categoryId = createdCategories[2]._id; // Tablet
            return { ...product, category: categoryId };
        });

        // Seed products
        await Product.insertMany(productsWithCategories);
        console.log('Products seeded');

        console.log('Database seeded successfully');
        process.exit();
    } catch (error) {
        console.error('Error seeding database:', error);
        process.exit(1);
    }
};

seedDatabase();
